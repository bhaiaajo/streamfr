<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search result for {term}</title>
    <link rel="stylesheet" href="/css/search.css">
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-2GSJRJYKS0"></script>
    <script>
      window.onload = () =>{
        
    const modal = document.getElementById("movie-modal");
    const closeModal = document.querySelector(".close");

    closeModal.onclick = () => {
        modal.style.display = "none";
    };
          document.getElementById("submit").onclick = () =>{
              if(!document.getElementById("search").value) return alert("Please enter a search term")
              window.location.href = "/search?q=" + document.getElementById("search").value
          }

          document.addEventListener("keypress", (e) =>{
              if(e.keyCode === 13){
                  const searchTerm = document.getElementById("search").value
                  if(!searchTerm) return alert("Please enter a search term")
                  window.open("/search?q="+ searchTerm)
                  document.getElementById("search").value = ""
                  window.location.href = "/search?q=" + document.getElementById("search").value
              }
          })
      }

      function handleCardClick(movieId, type) {
        if(type === "movie"){
            showMovieDetails(movieId, `/play/${movieId}${type === "tv" ? "?series=1" : ""}`);
        }else{
            showTVDetails(movieId, `/play/${movieId}${type === "tv" ? "?series=1" : ""}`)
        }
}
async function showMovieDetails(movieId, url) {
        const modal = document.getElementById("movie-modal");
        const movieDetailsContainer = document.getElementById("movie-details");

        try {
            const response = await fetch(`/api/movie/${movieId}`);
            const movie = await response.json();

            movieDetailsContainer.innerHTML = `
                <img src="https://image.tmdb.org/t/p/original${movie.backdrop_path}" alt="${movie.title}">
                <h2>${movie.title}</h2>
                <p><strong>Rating:</strong> ${movie.vote_average} / 10</p>
                <p>${movie.overview}</p>
                <a href="${url}" class="play-button">Watch Now</a>
            `;

            modal.style.display = "flex";       
        } catch (error) {
            console.error("Failed to load movie details:", error);
        }
    }
    async function showTVDetails(movieId, url) {
        const modal = document.getElementById("movie-modal");
        const movieDetailsContainer = document.getElementById("movie-details");

        try {
            const response = await fetch(`/api/tv/${movieId}`);
            const movie = await response.json();

            movieDetailsContainer.innerHTML = `
                <img src="https://image.tmdb.org/t/p/original${movie.backdrop_path}" alt="${movie.name}">
                <h2>${movie.name}</h2>
                <p><strong>Rating:</strong> ${movie.vote_average} / 10</p>
                <p>${movie.overview}</p>
                <a href="${url}" class="play-button">Watch Now</a>
            `;

            modal.style.display = "flex";       
        } catch (error) {
            console.error("Failed to load movie details:", error);
        }
    }

    window.onclick = (event) => {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
    </script>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo">Stream FR</div>
            <div class="navbar-links" style="margin-left: 20px;">
                <a href="/">Home</a>
                <a href="/docs">API</a>
                <a href="https://github.com/bhaiaajo/streamfr">GitHub</a>
                <a href="https://discord.com/invite/bqXhREHEDt">Discord</a>
            </div>
            <div class="search-container">
                <input type="text" id="search-bar" placeholder="Search movies...">
                <button class="submit" id="submit">ðŸ”Ž</button>
            </div>
        </nav>
    </header>
  <h1>Search results for {term}</h1>
  <div class="results">
    {code}
  </div>
  <div id="movie-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="movie-details"></div>
    </div>
</div>

</body>
</html>
