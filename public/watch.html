<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{name} - {id} - stream fr</title>
      <link rel="stylesheet" href="/css/play.css">
      <script type="text/javascript">
         (function(c,l,a,r,i,t,y){
             c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
             t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
             y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
         })(window, document, "clarity", "script", "oculg00e5e");
      </script>
      <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-2GSJRJYKS0"></script>
      <script>
         /*
        // Function to fetch ad patterns from EasyList, Badware List, and uBlock filters
        async function fetchAdPatterns() {
          try {
            // Fetch EasyList
            const easyListResponse = await fetch('https://easylist.to/easylist/easylist.txt');
            const easyListData = await easyListResponse.text();
            const easyListPatterns = easyListData.match(/(?:\|\|)([^\^]+)\^/g) || [];
        
            // Fetch Badware List
            const badwareListResponse = await fetch('https://github.com/uBlockOrigin/uAssets/raw/refs/heads/master/filters/badware.txt');
            const badwareListData = await badwareListResponse.text();
            const badwarePatterns = badwareListData.match(/(?:\|\|)([^\^]+)\^/g) || [];
        
            // Fetch uBlock Filters
            const uBlockListResponse = await fetch('https://github.com/uBlockOrigin/uAssets/raw/refs/heads/master/filters/filters.txt');
            const uBlockListData = await uBlockListResponse.text();
            const uBlockPatterns = uBlockListData.match(/\/\^[^$]+\/\$document/g) || [];
        
            // Combine and convert patterns into regular expressions
            const combinedPatterns = [...easyListPatterns, ...badwarePatterns, ...uBlockPatterns];
            return combinedPatterns.map(pattern => {
              // Handle complex regex patterns
              if (pattern.startsWith('/')) {
                return new RegExp(pattern.slice(1, -10).replace(/\^/g, '').replace(/\\/g, ''));
              }
              // Handle basic domain blocking patterns
              return new RegExp(pattern.replace(/\|\|/, '').replace(/\^/, ''));
            });
          } catch (error) {
            console.error('Error fetching ad blocklists:', error);
            return [];
          }
        }
        
        // Match the URL against all combined regex patterns
        function isAdRedirect(url, regexPatterns) {
          return regexPatterns.some(regex => regex.test(url));
        }
        
        // Block iframe redirects by intercepting navigation attempts inside the iframe
        function preventIframeRedirects(regexPatterns) {
          const observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
              mutation.addedNodes.forEach(node => {
                if (node.tagName === 'IFRAME') {
                  node.onload = () => {
                    try {
                      const iframeSrc = node.contentWindow.location.href;
                      if (isAdRedirect(iframeSrc, regexPatterns)) {
                        console.log('Blocked iframe redirect:', iframeSrc);
                        node.contentWindow.location.href = 'about:blank'; // Block the redirect
                      }
                    } catch (error) {
                      console.error('Error blocking iframe redirect:', error);
                    }
                  };
                }
              });
            });
          });
        
          observer.observe(document.body, {
            childList: true,
            subtree: true,
          });
        }
        
        // Aggressively block window location redirects
        function preventPageRedirects(regexPatterns) {
          // Override location.assign and location.replace
          const originalLocationAssign = window.location.assign;
          window.location.assign = function(url) {
            if (isAdRedirect(url, regexPatterns)) {
              console.log('Blocked redirect attempt to:', url);
            } else {
              originalLocationAssign.call(window.location, url);
            }
          };
        
          const originalLocationReplace = window.location.replace;
          window.location.replace = function(url) {
            if (isAdRedirect(url, regexPatterns)) {
              console.log('Blocked redirect attempt to:', url);
            } else {
              originalLocationReplace.call(window.location, url);
            }
          };
        }
        
        // Periodically check for iframe redirects
        function periodicIframeCheck(regexPatterns) {
          setInterval(() => {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
              try {
                const iframeSrc = iframe.contentWindow.location.href;
                if (isAdRedirect(iframeSrc, regexPatterns)) {
                  console.log('Blocked iframe redirect during periodic check:', iframeSrc);
                  iframe.contentWindow.location.href = 'about:blank';
                }
              } catch (error) {
                console.error('Error during iframe redirect check:', error);
              }
            });
          }, 2000);
        }
        
        // Fetch ad blocklists and apply blocking mechanisms
        (async function() {
          try {
            const regexPatterns = await fetchAdPatterns();
            if (regexPatterns.length > 0) {
              preventIframeRedirects(regexPatterns);  // Block iframe redirects
              preventPageRedirects(regexPatterns);    // Block page redirects
              periodicIframeCheck(regexPatterns);     // Periodic iframe checking
            } else {
              console.error('No patterns loaded from ad blocklists.');
            }
          } catch (error) {
            console.error('Error setting up ad-blocking:', error);
          }
        })();*/
        </script>
        
        
        <script>
        
         window.onload = ()=>{
             fetch(`/api/similar/{tmdbid}/{type}`).then(g =>g.json()).then(y =>{
             const addDiv = document.getElementById("image")
             y.results.forEach(x=>{
                 const img = document.createElement("img")
                 img.src = `https://image.tmdb.org/t/p/original` +x.poster_path
                 const anchor = document.createElement("a")
                 anchor.href = `/play/${x.id}{q}`
                 anchor.appendChild(img)
                 addDiv.appendChild(anchor)
             })
         })
         let cw = localStorage.getItem("continue") || localStorage.setItem("continue", "[]")
         try {
             cw = JSON.parse(cw) || []
         }catch{
             cw = JSON.parse(cw)
         }
         cw.push({name: "{name}", src: "{imgurl}", id: "{tmdbid}", href: window.location.href, type: "{type}"})
         const s = cw.reverse().filter((value, index, self) =>
         index === self.findIndex((t) => (
         t.place === value.place && t.name === value.name
         ))
         )
         localStorage.setItem("continue", JSON.stringify(s.reverse()))
         document.getElementById("submit").onclick = () =>{
         
         if(!document.getElementById("search").value) return alert("Please enter a search term")
         window.location.href = "/search?q=" + document.getElementById("search").value
         
         }
         
         document.addEventListener("keypress", (e) =>{
         if(e.keyCode === 13){
         const searchTerm = document.getElementById("search").value
         
         if(!searchTerm) return alert("Please enter a search term")
         
         window.open("/search?q="+ searchTerm)
         document.getElementById("textbox").value = ""
         window.location.href = "/search?q=" + document.getElementById("search").value
         }
         })
         }
         function onChange(obj){
             const video = document.getElementById("frame")
             video.src = `${obj.value}`
         }
      </script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         
         gtag('config', 'G-2GSJRJYKS0');
      </script>
      <script type='text/javascript' src='https://pl22991898.cpmrevenuegate.com/22/97/31/2297315db84866d51a7e3632043f6ae2.js'></script>
   </head>
   <meta property="og:title" content="stream fr" />
   <meta property="og:type" content="website"/>
   <meta property="og:url" content="https://streamfr.onrender.com/play/{id}" />
   <meta property="og:description" content="Watch {name} for free on stream fr" />
   <meta name="title" content="{name} - {id} - stream fr">
   <meta name="description" content="Watch {name} for free on stream fr.
      {text}
      ">
   <meta property="og:image" content="{imgurl}" />
   <body>
      <div class="topnav">
         <h1 style="color: white;float: left; font-size: 25px; margin-right: 15px; margin-left: 15px;font-family: Arial, Helvetica, sans-serif;">stream fr</h1>
         <a href="/">Home</a>
         <a href="https://github.com/bhaiaajo">Github</a>
         <a href="https://discord.com/invite/bqXhREHEDt">Discord</a>
      </div>
      <center>
         <div class="search">
            <input type="text" placeholder="Search Movies/Shows" id="search" class="searchbar">
            <button id="submit" class="submit">üîç</button>
         </div>
      </center>
      <h1 style="color: white; font-family: 'Courier New', Courier, monospace;">
         Sources (Change if not working or for languages): 
      </h1>
      <div class="select">
         <select id="server" onchange="onChange(this)">
         {ddcode}
         </select>
      </div>
      <iframe src="{streamurl}" frameborder="0" allowfullscreen style="width: 100%;height:700px;" id="frame">
      </iframe>
      <div class="infobox">
         <img src="{imgurl}" alt="Image">
         <p>{text}</p>
      </div>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="similar" id="similar" style="display: block;margin-left: 20px;">
         <h1 style="color: whitesmoke;font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">Similar movies/shows to watch</h1>
         <div id="image" class="image">
         </div>
      </div>
   </body>
</html>
